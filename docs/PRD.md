# [PRD] 프롬프트 스토어 "Prompt Market"

## 1. 서비스 컨셉 및 모델

- **컨셉:** 운영자가 등록한 AI 프롬프트를 사용자가 장바구니에 담아 한 번에 결제하거나, 프로필을 관리할 수 있는 온라인 상점.
- **사용자 역할:**
    - **관리자 (Admin):** 유일한 판매자. Supabase 대시보드를 통해 상품(프롬프트) 등록/관리.
    - **사용자 (User):** 회원가입 후 프롬프트를 장바구니에 담고, 구매하며, 자신의 프로필을 관리하는 소비자.

## 2. 상세 화면 명세서 (Screen Specifications)

### 2.1. 헤더 (Header - 모든 페이지 공통)
- **역할:** 사이트의 핵심 기능으로 빠르게 이동할 수 있는 전역 네비게이션 제공.
- **컴포넌트 및 기능:**
    - **로고:** 클릭 시 메인 페이지(`/`)로 이동.
    - **장바구니 아이콘:**
        - **데이터:** 현재 사용자의 `carts` 테이블에 담긴 상품 개수를 실시간으로 표시 (예: 뱃지 형태).
        - **동작:** 클릭 시 장바구니 페이지(`/cart`)로 이동.
    - **사용자 프로필 드롭다운:**
        - **로그인 안했을 때:** '로그인' 버튼 표시.
        - **로그인 했을 때:** 사용자 프로필 이미지 또는 닉네임 표시.
            - **동작:** 클릭 시 드롭다운 메뉴 표시.
                - '프로필 관리' 메뉴 (클릭 시 `/profile`로 이동)
                - '구매 내역' 메뉴 (클릭 시 `/my-page`로 이동)
                - '로그아웃' 버튼

---

### 2.2. 메인 페이지 (프롬프트 목록)
- **경로:** `/`
- **역할:** 판매 중인 모든 프롬프트 리스트를 보여주는 스토어의 진열대.
- **주요 데이터:** `prompts` 테이블의 모든 상품 정보.
- **컴포넌트 및 기능:**
    - **`PromptCard` (개별 프롬프트 카드):**
        - **표시 정보:** 대표 이미지, 제목, 가격.
        - **하단 버튼:**
            - **'상세보기' 버튼:** 클릭 시 상세 페이지(`/prompt/[id]`)로 이동.
            - **'장바구니 담기' 버튼:**
                - **동작:** 클릭 시 해당 상품을 사용자의 `carts` 테이블에 추가.
                - **피드백:** "장바구니에 상품을 담았습니다." 와 같은 토스트(Toast) 알림을 띄워 사용자에게 행동이 완료되었음을 알림.
                - **상태 처리:** 만약 이미 장바구니에 있는 상품이라면 버튼을 비활성화하고 "장바구니에 있음"으로 표시.

---

### 2.3. 프롬프트 상세 페이지
- **경로:** `/prompt/[id]`
- **역할:** 개별 프롬프트의 상세 정보 제공 및 구매/장바구니 액션 유도.
- **주요 데이터:**
    - URL의 `[id]`에 해당하는 `prompts` 테이블 정보.
    - 로그인 사용자의 `purchases` 테이블 (해당 상품 구매 여부 확인용).
    - 로그인 사용자의 `carts` 테이블 (해당 상품 장바구니 존재 여부 확인용).
- **컴포넌트 및 기능:**
    - **구매 완료 시 (가장 높은 우선순위):**
        - 구매 버튼 영역을 모두 제거.
        - 마스킹된 영역에 실제 프롬프트 내용(`prompt_text`)과 '복사' 버튼 표시.
    - **구매 전:**
        - **상품 정보 영역:** 제목, 상세 설명, 결과물 예시 이미지 갤러리 표시.
        - **프롬프트 내용 영역:** "구매 후 내용을 확인하실 수 있습니다." 메시지로 마스킹 처리.
        - **액션 버튼 영역:**
            - **'장바구니 담기' 버튼:** 위 메인 페이지의 버튼과 동일한 로직.
            - **'바로 구매하기' 버튼:**
                - **동작:** 클릭 시, 해당 상품을 장바구니에 담고 **즉시 결제 페이지로 이동**시키는 로직을 수행 (또는 바로 결제창 호출).

---

### 2.4. 장바구니 페이지
- **경로:** `/cart`
- **역할:** 사용자가 구매할 상품들을 최종 확인하고 결제를 진행하는 페이지.
- **주요 데이터:** 로그인 사용자의 `carts` 테이블과 연결된 `prompts` 테이블 정보.
- **컴포넌트 및 기능:**
    - **장바구니 목록 영역:**
        - **장바구니가 비어있을 때:** "장바구니가 비어있습니다." 메시지와 함께 메인 페이지로 가는 링크 버튼 표시.
        - **상품이 있을 때:**
            - **`CartItem` (개별 상품 행):**
                - **구성:** 상품 이미지, 제목, 가격.
                - **'삭제' 버튼:** 클릭 시 해당 상품을 `carts` 테이블에서 제거하고 UI를 즉시 업데이트.
    - **결제 정보 요약 영역:**
        - **'총 N개의 상품'**: `carts` 테이블의 아이템 개수.
        - **'총 주문금액: OOO원'**: 모든 상품의 `price`를 합산한 금액.
    - **'결제하기' 버튼:**
        - **동작:** 클릭 시 장바구니의 모든 상품 정보를 기반으로 토스페이먼츠 결제창 호출.

---

### 2.5. 사용자 프로필 페이지
- **경로:** `/profile`
- **역할:** 사용자가 자신의 계정 정보를 확인하고 수정하는 페이지.
- **주요 데이터:** 로그인한 사용자의 `profiles` 테이블 정보 (닉네임, 이메일 등).
- **컴포넌트 및 기능:**
    - **프로필 정보 표시:**
        - 이메일 주소 (수정 불가, 읽기 전용으로 표시).
        - 닉네임.
    - **프로필 수정 기능:**
        - **'수정하기' 버튼:** 클릭 시 닉네임 필드가 `input` 태그로 변경되고 '저장', '취소' 버튼이 나타남.
        - **'저장' 버튼:**
            - **동작:** 클릭 시 `input`에 입력된 값으로 `profiles` 테이블의 `nickname`을 업데이트하는 API 호출.
            - **피드백:** "프로필이 저장되었습니다." 토스트 알림 표시 후 다시 읽기 모드로 전환.
        - **(선택) 프로필 이미지 업로드:**
            - 이미지 클릭 시 파일 선택창 열림.
            - 이미지 선택 시 Supabase Storage에 업로드하고, 해당 URL을 `profiles` 테이블의 `avatar_url`에 저장.

---

### 2.6. 구매 내역 페이지
- **경로:** `/my-page`
- **역할:** 사용자가 구매한 모든 프롬프트 목록을 확인.
- **UI 및 기능:** 이전 PRD와 동일.

## 3. 데이터베이스 "예시" 스키마 (Supabase)

아래 데이터베이스의 스키마는 서비스를 설명하기 위한 예시이기 때문에 

### `profiles` (사용자 프로필 테이블)
- `id` (uuid, PK, FK to `auth.users.id`): 사용자 인증 ID와 1:1 관계
- `nickname` (text): 사용자 닉네임
- `avatar_url` (text, nullable): 프로필 이미지 URL
- `updated_at` (timestamp): 정보 수정일

### prompts (상품 테이블)
- id (uuid, PK): 프롬프트 고유 ID
- created_at (timestamp): 생성일
- title (text): 프롬프트 제목
- description (text): 상세 설명
- price (integer): 가격
- prompt_text (text): 실제 프롬프트 내용 (핵심 데이터)
- image_urls (text[]): 결과물 이미지 URL 배열 (Supabase Storage 경로)

### `carts` (장바구니 테이블)
- `id` (bigint, PK): 장바구니 항목 고유 ID
- `created_at` (timestamp): 생성일
- `user_id` (uuid, FK to `auth.users.id`): 사용자 ID
- `prompt_id` (uuid, FK to `prompts.id`): 담긴 프롬프트 ID
- *Constraint: `user_id`와 `prompt_id`의 조합은 `unique`해야 함 (중복 담기 방지)*

### purchases (주문/구매 기록 테이블)
- id (uuid, PK): 구매 기록 고유 ID
- created_at (timestamp): 구매일
- buyer_id (uuid, FK to auth.users): 구매자 ID
- prompt_id (uuid, FK to prompts): 구매한 프롬프트 ID
- payment_order_id (text, unique): 토스페이먼츠 주문 ID

## 4. 핵심 로직 구현 노트

- **장바구니 로직:**
    - 사용자가 '결제하기'를 눌러 결제에 성공하면, `carts` 테이블에서 구매가 완료된 상품들을 반드시 **삭제**해야 합니다.
    - 이 과정은 **트랜잭션**으로 처리하는 것이 가장 안전합니다. (결제 승인 → `purchases` 기록 → `carts` 삭제)
- **결제 로직 (장바구니):**
    - '결제하기' 버튼 클릭 시, 서버는 해당 유저의 `carts` 테이블을 조회하여 총액을 계산하고 이 정보를 토대로 결제를 요청해야 합니다. 클라이언트가 보내는 가격을 그대로 믿으면 안 됩니다.
- **프로필과 인증의 분리:**
    - Supabase의 `auth.users` 테이블은 인증 정보를 다루고, 별도의 `profiles` 테이블을 만들어 부가 정보를 저장하는 것이 권장되는 패턴입니다. 회원가입 시 트리거(Trigger)를 사용하여 `auth.users`에 새 레코드가 생길 때 `profiles`에도 자동으로 레코드를 생성하도록 설정하면 편리합니다.
